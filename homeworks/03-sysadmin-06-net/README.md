## Домашнее задание к занятию "3.6. Компьютерные сети, лекция 1"

 ---
### 1. Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе на 2.4 ГГц. Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный ответ и на этот вопрос.

*В диапазоне 2,4 ГГц стандартами определено 14 каналов. Некоторые из них могут быть недоступны в ряде стран (например, 14 канал разрешен для использования только в Японии).*

 ---
### 2. Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC `38:f9:d3:55:55:79`?


```al
OUI: 38:F9:D3
Vendor name: Apple, Inc.
```

 ---
### 3. Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт, а TCP – 32 байта?

*8949*

 ---
### 4. Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети? Почему да или нет?


*Думаю, что нет, так как флаг SYN устанавливается при инициализации соединения, а флаг FIN при завершении соединения.*

 ---
### 5. `ss -ula sport = :53` на хосте имеет следующий вывод:

```bash
State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
```

Почему в `State` присутствует только `UNCONN`, и может ли там присутствовать, например, `TIME-WAIT`?

*`UNCONN`- говорит о том, что соединение не установлено. Что касается состояния `TIME-WAIT`, то в данном случае его не может быть, так как опция -u говорит о том, что необходимо показвать вывод UDP соединений, а состояние `TIME-WAIT` не может быть для UDP cоединения.*

 ---
### 6. Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении. Схема переходов состояния соединения вам в этом поможет.

*При установленном соединении оба клиент и сервер находятся в состоянии ESTABLISHED, после завершения передачи данны одна из сторон, например клиент отправляет сообщение с установленным флагом FIN 1, после чего сам преходит в состояние FIN-WAIT-1, сервер получив это сообщение отправляет в ответ подтверждающее сообщение ACK 1 и переходит в состояние CLOSE-WAIT. После того как сервер передаст клиенту последние данные, он отправляет сообщение с флаго FIN и переходит в состояние LAST-ACK, клиент получив сообщение FIN отправляет подтверждающее сообщение ACK и переходит в состояния TIME-WAIT и по истечении установленного времени 2MSL клиент переходит в состояние CLOSE, в свою очередь сервер получив подстверждающее сообщение от клинета также переходит в состояние CLOSE.*

 ---
### 7. TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения. Каким будет теоретическое максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше одного?

*Теоритическое максимальное количество соединений клиент с одним IP к серверу с одним IP 65536 (максимальное количество портов 2 в 16 степени = 65536), на каждого клиента теоритически также может приходиться 65536 соединений.*

 ---
### 8. Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии  `TIME-WAIT`? Если да, то является ли она хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.

*Видимо если будет создаться и тут же закрываться очень большое количество коротких tcp-соединений, а так как типичная продолжительность `TIME-WAIT` от 1 до 4 минт, количество соединений в этом состоянии будет быстро накапливаться. Полгаю, что это очень плохо, так как при достижении определанного количество сессий `TIME-WAIT`, сервер большен сможет создавать новые TCP-соединения.*

 ---
### 9. Чем особенно плоха фрагментация UDP относительно фрагментации TCP?

*Фрагментации TCP выполняется самим протоколом TCP, который с случае потери фрагмента может самостоятельно осуществить повторную передачу сегмента. В случае с UDP фрагментация дейтаграмм осуществляется протоколом IP на сетевом уровне. Так как IP не имеет тайм-аутов и не осуществляет повторную передачу, то если в процессе передачи пропадет один из пакетов с фрагментами, потеряна будет вся дейтаграмма. Также следует учесть, что когда IP фрагментируется, он не будет обратно собираться, пока не достигнет конечного пункта назначения, при этом IP может дополнительно фрагментироваться на промежуточных маршрутизаторах, что в свою очередь может негативно сказаться на производительности.*

 ---
### 10. Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.


`Как мне кажется, для системы удаленного сбора логов очень важна гарантированная доставка сообщений, в этом случае лучшим выбором будет протокол TCP. В тоже время возможно и использование протока UDP, но в этом случае само приложение должно будет отслеживать недоставленные данные и снова запрашивать их доставку. Выбор в пользу TCP так же может быть сделан, если требуется обеспечить защиту передаваемых данных с помощью протокола TLS, так как он не работает с UDP.`

 ---
### 11. Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?


```bash
vagrant@vagrant:~$ ss -alt
State                       Recv-Q                      Send-Q                                           Local Address:Port                                             Peer Address:Port                      Process
LISTEN                      0                           4096                                             127.0.0.53%lo:domain                                                0.0.0.0:*
LISTEN                      0                           128                                                    0.0.0.0:ssh                                                   0.0.0.0:*
LISTEN                      0                           128                                                       [::]:ssh                                                      [::]:*
```

 ---
### 12. Какой ключ нужно добавить в `tcpdump`, чтобы он начал выводить не только заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и шестнадцатиричном?


```bash
root@vagrant:~# tcpdump -A -c 1
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
13:32:34.441281 IP vagrant.ssh > _gateway.3239: Flags [P.], seq 4208203761:4208203797, ack 13774895, win 63904, length 36
E..L.4@.@.[W
...
.............0/P....O.."L]..Rwi...f..|..T.&.j`~<..#S<E....q
1 packet captured
10 packets received by filter
0 packets dropped by kernel
```


```bash
root@vagrant:~# tcpdump -A -c 1
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
13:32:34.441281 IP vagrant.ssh > _gateway.3239: Flags [P.], seq 4208203761:4208203797, ack 13774895, win 63904, length 36
E..L.4@.@.[W
...
.............0/P....O.."L]..Rwi...f..|..T.&.j`~<..#S<E....q
1 packet captured
10 packets received by filter
0 packets dropped by kernel
```


 ---
### 13. Попробуйте собрать дамп трафика с помощью `tcpdump` на основном интерфейсе вашей виртуальной машины и посмотреть его через tshark или Wireshark (можно ограничить число пакетов `-c 100`). Встретились ли вам какие-то установленные флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется стандарт Ethernet, фреймы которого попали в ваш дамп? Можно ли где-то в дампе увидеть OUI?


```bash
root@vagrant:~# tcpdump -i eth0 -c 100 -w dump.pcap
tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
100 packets captured
101 packets received by filter
0 packets dropped by kernel
root@vagrant:~#
root@vagrant:~#
root@vagrant:~# tshark -r dump.pcap
Running as user "root" and group "root". This could be dangerous.
    1   0.000000    10.0.2.15 → 10.0.2.2     SSH 90 Server: Encrypted packet (len=36)
    2   0.000258     10.0.2.2 → 10.0.2.15    TCP 60 3239 → 22 [ACK] Seq=1 Ack=37 Win=65535 Len=0
    3 107.703521     10.0.2.2 → 10.0.2.15    TCP 60 1112 → 22 [SYN] Seq=0 Win=65535 Len=0 MSS=1460
    4 107.703565    10.0.2.15 → 10.0.2.2     TCP 58 22 → 1112 [SYN, ACK] Seq=0 Ack=1 Win=64240 Len=0 MSS=1460
    5 107.706214     10.0.2.2 → 10.0.2.15    TCP 60 1112 → 22 [ACK] Seq=1 Ack=1 Win=65535 Len=0
    6 107.706214     10.0.2.2 → 10.0.2.15    SSH 87 Client: Protocol (SSH-2.0-OpenSSH_for_Windows_8.1)
    7 107.706242    10.0.2.15 → 10.0.2.2     TCP 54 22 → 1112 [ACK] Seq=1 Ack=34 Win=64207 Len=0
    8 107.712901    10.0.2.15 → 10.0.2.2     SSHv2 95 Server: Protocol (SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5)
    9 107.713131     10.0.2.2 → 10.0.2.15    TCP 60 1112 → 22 [ACK] Seq=34 Ack=42 Win=65535 Len=0
   10 107.713869     10.0.2.2 → 10.0.2.15    SSHv2 1446 Client: Key Exchange Init
   11 107.713879    10.0.2.15 → 10.0.2.2     TCP 54 22 → 1112 [ACK] Seq=42 Ack=1426 Win=64032 Len=0
   12 107.714774    10.0.2.15 → 10.0.2.2     SSHv2 1110 Server: Key Exchange Init
   13 107.715053     10.0.2.2 → 10.0.2.15    TCP 60 1112 → 22 [ACK] Seq=1426 Ack=1098 Win=65535 Len=0
   14 107.716946     10.0.2.2 → 10.0.2.15    SSHv2 102 Client: Diffie-Hellman Key Exchange Init
   15 107.716954    10.0.2.15 → 10.0.2.2     TCP 54 22 → 1112 [ACK] Seq=1098 Ack=1474 Win=64032 Len=0
   16 107.721874    10.0.2.15 → 10.0.2.2     SSHv2 562 Server: Diffie-Hellman Key Exchange Reply, New Keys, Encrypted packet (len=228)
   17 107.722102     10.0.2.2 → 10.0.2.15    TCP 60 1112 → 22 [ACK] Seq=1474 Ack=1606 Win=65535 Len=0
   .   .   .
   98 118.472676    10.0.2.15 → 8.8.8.8      ICMP 98 Echo (ping) request  id=0x0001, seq=2/512, ttl=64
   99 118.559767      8.8.8.8 → 10.0.2.15    ICMP 98 Echo (ping) reply    id=0x0001, seq=2/512, ttl=117 (request in 98)
  100 118.560734    10.0.2.15 → 10.0.2.2     SSHv2 98 Server: Encrypted packet (len=44)
```

 
 ---

